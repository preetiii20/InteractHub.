{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\HP\\\\Desktop\\\\Interacthub\\\\frontend\\\\src\\\\components\\\\admin\\\\GlobalCommunications.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport axios from 'axios';\nimport { motion } from 'framer-motion';\nimport apiConfig from '../../config/api';\nimport { authHelpers } from '../../config/auth';\nimport AnnouncementList from '../shared/AnnouncementList';\nimport PollList from '../shared/PollList';\nimport SockJS from 'sockjs-client';\nimport { Client } from '@stomp/stompjs';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst GlobalCommunications = () => {\n  _s();\n  var _stompRef$current;\n  const [announcements, setAnnouncements] = useState([]);\n  const [polls, setPolls] = useState([]);\n  const [message, setMessage] = useState(null);\n  const [formAnn, setFormAnn] = useState({\n    title: '',\n    content: '',\n    type: 'GENERAL'\n  });\n  const [formPoll, setFormPoll] = useState({\n    question: '',\n    options: ['']\n  });\n  const [commentDrafts, setCommentDrafts] = useState({});\n  const [pollChoice, setPollChoice] = useState({});\n  const [pollResults, setPollResults] = useState({});\n  const [userLikes, setUserLikes] = useState({}); // Track which announcements user has liked\n  const [userVotes, setUserVotes] = useState({}); // Track which polls user has voted on\n  const [likeCounts, setLikeCounts] = useState({}); // Track like counts for announcements\n  const [comments, setComments] = useState({}); // Track comments for announcements\n\n  const stompRef = useRef(null);\n  const loadAll = async () => {\n    try {\n      console.log('Loading communications...');\n\n      // Try target-specific endpoint first, fallback to all announcements\n      let announcementsData = [];\n      let pollsData = [];\n      try {\n        const ra = await axios.get(`${apiConfig.adminService}/announcements/target/ALL`);\n        announcementsData = ra.data || [];\n      } catch (error) {\n        console.log('Fallback: Loading all announcements...');\n        const ra = await axios.get(`${apiConfig.adminService}/announcements`);\n        announcementsData = ra.data || [];\n      }\n      try {\n        const rp = await axios.get(`${apiConfig.adminService}/polls/target/ALL`);\n        pollsData = rp.data || [];\n      } catch (error) {\n        console.log('Fallback: Loading all polls...');\n        const rp = await axios.get(`${apiConfig.adminService}/polls`);\n        pollsData = rp.data || [];\n      }\n      console.log('Announcements loaded:', announcementsData);\n      console.log('Polls loaded:', pollsData);\n      setAnnouncements(announcementsData);\n      setPolls(pollsData);\n      pollsData.forEach(p => refreshPollResults(p.id));\n\n      // Load additional data only if we have announcements\n      if (announcementsData && announcementsData.length > 0) {\n        // Load user's current like status for all announcements\n        loadUserLikes(announcementsData);\n        // Load like counts for all announcements\n        loadLikeCounts(announcementsData);\n        // Load comments for all announcements\n        loadComments(announcementsData);\n      }\n    } catch (error) {\n      console.error('Error loading communications:', error);\n      setMessage({\n        type: 'error',\n        text: `Failed to fetch communications: ${error.message}`\n      });\n      // Set empty arrays on error\n      setAnnouncements([]);\n      setPolls([]);\n    }\n  };\n  const loadUserLikes = async announcements => {\n    const currentUser = authHelpers.getUserName() || 'User';\n    const likes = {};\n\n    // If no announcements, return early\n    if (!announcements || announcements.length === 0) {\n      setUserLikes(likes);\n      return;\n    }\n\n    // Process announcements in batches to avoid overwhelming the server\n    const batchSize = 3;\n    for (let i = 0; i < announcements.length; i += batchSize) {\n      const batch = announcements.slice(i, i + batchSize);\n      const batchPromises = batch.map(async ann => {\n        try {\n          const base = apiConfig.chatService.replace('/api/chat', '/api/interactions');\n          const response = await fetch(`${base}/announcement/${ann.id}/interactions`);\n          if (!response.ok) {\n            console.error(`Failed to load interactions for announcement ${ann.id}:`, response.status);\n            return {\n              id: ann.id,\n              liked: false\n            };\n          }\n          const interactions = await response.json();\n          const userLike = interactions.find(i => i.userName === currentUser && i.type === 'LIKE');\n          return {\n            id: ann.id,\n            liked: !!userLike\n          };\n        } catch (error) {\n          console.error(`Error loading likes for announcement ${ann.id}:`, error);\n          return {\n            id: ann.id,\n            liked: false\n          };\n        }\n      });\n      try {\n        const batchResults = await Promise.all(batchPromises);\n        batchResults.forEach(result => {\n          likes[result.id] = result.liked;\n        });\n\n        // Small delay between batches to prevent overwhelming the server\n        if (i + batchSize < announcements.length) {\n          await new Promise(resolve => setTimeout(resolve, 100));\n        }\n      } catch (error) {\n        console.error('Error processing batch:', error);\n        // Set all announcements in this batch to not liked\n        batch.forEach(ann => {\n          likes[ann.id] = false;\n        });\n      }\n    }\n    setUserLikes(likes);\n  };\n  const loadLikeCounts = async announcements => {\n    const counts = {};\n\n    // If no announcements, return early\n    if (!announcements || announcements.length === 0) {\n      setLikeCounts(counts);\n      return;\n    }\n\n    // Process announcements in batches to avoid overwhelming the server\n    const batchSize = 5;\n    for (let i = 0; i < announcements.length; i += batchSize) {\n      const batch = announcements.slice(i, i + batchSize);\n      const batchPromises = batch.map(async ann => {\n        try {\n          const base = apiConfig.chatService.replace('/api/chat', '/api/interactions');\n          const response = await fetch(`${base}/announcement/${ann.id}/likes/count`);\n          if (!response.ok) {\n            console.error(`Failed to load like count for announcement ${ann.id}:`, response.status);\n            return {\n              id: ann.id,\n              count: 0\n            };\n          }\n          const result = await response.json();\n          return {\n            id: ann.id,\n            count: result.count || 0\n          };\n        } catch (error) {\n          console.error(`Error loading like count for announcement ${ann.id}:`, error);\n          return {\n            id: ann.id,\n            count: 0\n          };\n        }\n      });\n      try {\n        const batchResults = await Promise.all(batchPromises);\n        batchResults.forEach(result => {\n          counts[result.id] = result.count;\n        });\n\n        // Small delay between batches to prevent overwhelming the server\n        if (i + batchSize < announcements.length) {\n          await new Promise(resolve => setTimeout(resolve, 50));\n        }\n      } catch (error) {\n        console.error('Error processing like counts batch:', error);\n        // Set all announcements in this batch to 0 likes\n        batch.forEach(ann => {\n          counts[ann.id] = 0;\n        });\n      }\n    }\n    setLikeCounts(counts);\n  };\n  const loadComments = async announcements => {\n    const allComments = {};\n\n    // If no announcements, return early\n    if (!announcements || announcements.length === 0) {\n      setComments(allComments);\n      return;\n    }\n\n    // Process announcements in batches to avoid overwhelming the server\n    const batchSize = 5;\n    for (let i = 0; i < announcements.length; i += batchSize) {\n      const batch = announcements.slice(i, i + batchSize);\n      const batchPromises = batch.map(async ann => {\n        try {\n          const base = apiConfig.chatService.replace('/api/chat', '/api/interactions');\n          const response = await fetch(`${base}/announcement/${ann.id}/interactions`);\n          if (!response.ok) {\n            console.error(`Failed to load comments for announcement ${ann.id}:`, response.status);\n            return {\n              id: ann.id,\n              comments: []\n            };\n          }\n          const interactions = await response.json();\n          const commentList = interactions.filter(i => i.type === 'COMMENT');\n          return {\n            id: ann.id,\n            comments: commentList\n          };\n        } catch (error) {\n          console.error(`Error loading comments for announcement ${ann.id}:`, error);\n          return {\n            id: ann.id,\n            comments: []\n          };\n        }\n      });\n      try {\n        const batchResults = await Promise.all(batchPromises);\n        batchResults.forEach(result => {\n          allComments[result.id] = result.comments;\n        });\n\n        // Small delay between batches to prevent overwhelming the server\n        if (i + batchSize < announcements.length) {\n          await new Promise(resolve => setTimeout(resolve, 50));\n        }\n      } catch (error) {\n        console.error('Error processing comments batch:', error);\n        // Set all announcements in this batch to empty comments\n        batch.forEach(ann => {\n          allComments[ann.id] = [];\n        });\n      }\n    }\n    setComments(allComments);\n  };\n  useEffect(() => {\n    loadAll();\n    // Use chat service WebSocket for likes/comments, admin service WebSocket for deletions\n    const chatSocket = new SockJS(apiConfig.websocketUrl);\n    const adminSocket = new SockJS(apiConfig.adminWebsocketUrl);\n    const chatClient = new Client({\n      webSocketFactory: () => chatSocket,\n      reconnectDelay: 3000\n    });\n    const adminClient = new Client({\n      webSocketFactory: () => adminSocket,\n      reconnectDelay: 3000\n    });\n\n    // Chat service WebSocket for likes/comments\n    chatClient.onConnect = () => {\n      chatClient.subscribe('/topic/announcements.new', () => loadAll());\n      chatClient.subscribe('/topic/polls.new', () => loadAll());\n      chatClient.subscribe('/topic/polls.votes', msg => {\n        try {\n          const v = JSON.parse(msg.body || '{}');\n          if (v !== null && v !== void 0 && v.pollId) refreshPollResults(v.pollId);\n        } catch {}\n      });\n\n      // Subscribe to general announcement reactions\n      chatClient.subscribe('/topic/announcements.reactions', msg => {\n        try {\n          const reaction = JSON.parse(msg.body || '{}');\n          if (reaction.type === 'LIKE') {\n            // Update like status for the specific announcement\n            setUserLikes(prev => ({\n              ...prev,\n              [reaction.announcementId]: reaction.liked\n            }));\n            // Also refresh the data to get updated like counts\n            loadAll();\n          } else if (reaction.type === 'COMMENT') {\n            // Refresh comments when new comment is added\n            console.log('Comment reaction received:', reaction);\n            // Refresh all data to get updated comments\n            loadAll();\n          }\n        } catch (error) {\n          console.error('Error processing announcement reaction:', error);\n        }\n      });\n    };\n\n    // Admin service WebSocket for deletions\n    adminClient.onConnect = () => {\n      // Subscribe to deletion events\n      adminClient.subscribe('/topic/announcements.deleted', msg => {\n        try {\n          const deletion = JSON.parse(msg.body || '{}');\n          console.log('Announcement deleted:', deletion);\n          // Remove the deleted announcement from the list\n          setAnnouncements(prev => prev.filter(ann => ann.id !== deletion.id));\n        } catch (error) {\n          console.error('Error processing announcement deletion:', error);\n        }\n      });\n      adminClient.subscribe('/topic/polls.deleted', msg => {\n        try {\n          const deletion = JSON.parse(msg.body || '{}');\n          console.log('Poll deleted:', deletion);\n          // Remove the deleted poll from the list\n          setPolls(prev => prev.filter(poll => poll.id !== deletion.id));\n        } catch (error) {\n          console.error('Error processing poll deletion:', error);\n        }\n      });\n    };\n    chatClient.activate();\n    adminClient.activate();\n    stompRef.current = {\n      chat: chatClient,\n      admin: adminClient\n    };\n    return () => {\n      chatClient.deactivate();\n      adminClient.deactivate();\n    };\n  }, []);\n\n  // Subscribe to individual announcement like and comment updates when announcements change\n  useEffect(() => {\n    if (stompRef.current && stompRef.current.chat && stompRef.current.chat.connected) {\n      announcements.forEach(ann => {\n        // Subscribe to likes\n        stompRef.current.chat.subscribe(`/topic/announcement.${ann.id}.likes`, msg => {\n          const count = parseInt(msg.body) || 0;\n          // Refresh all data to get updated like counts\n          loadAll();\n        });\n\n        // Subscribe to comments\n        stompRef.current.chat.subscribe(`/topic/announcement.${ann.id}.comments`, msg => {\n          console.log('New comment received for announcement', ann.id, ':', msg.body);\n          // Refresh all data to get updated comments\n          loadAll();\n        });\n      });\n    }\n  }, [announcements]);\n  const refreshPollResults = async pollId => {\n    try {\n      const base = apiConfig.chatService.replace('/api/chat', '/api/interactions');\n      const res = await fetch(`${base}/poll/${pollId}/results`);\n      const results = await res.json();\n      setPollResults(prev => ({\n        ...prev,\n        [pollId]: results || {\n          totalVotes: 0,\n          optionCounts: {}\n        }\n      }));\n    } catch {}\n  };\n\n  // Create ALL-only\n  const createAnnouncement = async e => {\n    e.preventDefault();\n    try {\n      await axios.post(`${apiConfig.adminService}/announcements`, {\n        title: formAnn.title,\n        content: formAnn.content,\n        type: (formAnn.type || 'GENERAL').toUpperCase(),\n        targetAudience: 'ALL',\n        createdByName: authHelpers.getUserName() || 'User'\n      });\n      setFormAnn({\n        title: '',\n        content: '',\n        type: 'GENERAL'\n      });\n      setMessage({\n        type: 'success',\n        text: 'Announcement posted.'\n      });\n      loadAll();\n    } catch (err) {\n      var _err$response, _err$response$data;\n      setMessage({\n        type: 'error',\n        text: (err === null || err === void 0 ? void 0 : (_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.error) || 'Failed to post announcement'\n      });\n    }\n  };\n  const createPoll = async e => {\n    e.preventDefault();\n    const options = (formPoll.options || []).map(o => (o || '').trim()).filter(Boolean);\n    if (options.length < 2) {\n      setMessage({\n        type: 'error',\n        text: 'A poll needs at least two options.'\n      });\n      return;\n    }\n    try {\n      await axios.post(`${apiConfig.adminService}/polls`, {\n        question: formPoll.question,\n        options,\n        targetAudience: 'ALL',\n        createdByName: authHelpers.getUserName() || 'User',\n        isActive: true\n      });\n      setFormPoll({\n        question: '',\n        options: ['']\n      });\n      setMessage({\n        type: 'success',\n        text: 'Poll created.'\n      });\n      loadAll();\n    } catch (err) {\n      var _err$response2, _err$response2$data;\n      setMessage({\n        type: 'error',\n        text: (err === null || err === void 0 ? void 0 : (_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.error) || 'Failed to create poll'\n      });\n    }\n  };\n\n  // Interactions to chat-service (name-only)\n  const likeAnnouncement = async ann => {\n    try {\n      const base = apiConfig.chatService.replace('/api/chat', '/api/interactions');\n      const response = await fetch(`${base}/announcement/like`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          announcementId: ann.id,\n          userName: authHelpers.getUserName() || 'User',\n          type: 'LIKE'\n        })\n      });\n      if (!response.ok) {\n        console.error('Like request failed:', response.status, response.statusText);\n        return;\n      }\n      const result = await response.json();\n      console.log('Like response:', result);\n\n      // Update the like status for this announcement\n      setUserLikes(prev => ({\n        ...prev,\n        [ann.id]: result.liked\n      }));\n\n      // Also refresh the like count\n      loadAll();\n    } catch (error) {\n      console.error('Like error:', error);\n    }\n  };\n  const commentAnnouncement = async (ann, text) => {\n    const content = String(text || '').trim();\n    if (!content) return;\n    try {\n      const base = apiConfig.chatService.replace('/api/chat', '/api/interactions');\n      await fetch(`${base}/announcement/comment`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          announcementId: ann.id,\n          userName: authHelpers.getUserName() || 'User',\n          content,\n          type: 'COMMENT'\n        })\n      });\n      setCommentDrafts(p => ({\n        ...p,\n        [ann.id]: ''\n      }));\n      // Refresh comments for this announcement\n      loadComments([ann]);\n    } catch {}\n  };\n  const votePoll = async (poll, selected) => {\n    if (!selected) return;\n    try {\n      const base = apiConfig.chatService.replace('/api/chat', '/api/interactions');\n      await fetch(`${base}/poll/vote`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          pollId: poll.id,\n          voterName: authHelpers.getUserName() || 'User',\n          selectedOption: selected\n        })\n      });\n      setPollChoice(p => ({\n        ...p,\n        [poll.id]: ''\n      }));\n      setUserVotes(p => ({\n        ...p,\n        [poll.id]: selected\n      }));\n      refreshPollResults(poll.id);\n    } catch {}\n  };\n  const deleteAnnouncement = async id => {\n    if (!window.confirm('Are you sure you want to delete this announcement?')) return;\n    try {\n      const userName = authHelpers.getUserName() || 'User';\n      await axios.delete(`${apiConfig.adminService}/announcements/${id}`, {\n        headers: {\n          'X-User-Name': userName\n        }\n      });\n      setMessage({\n        type: 'success',\n        text: 'Announcement deleted successfully.'\n      });\n      loadAll();\n    } catch (err) {\n      var _err$response3, _err$response3$data;\n      setMessage({\n        type: 'error',\n        text: (err === null || err === void 0 ? void 0 : (_err$response3 = err.response) === null || _err$response3 === void 0 ? void 0 : (_err$response3$data = _err$response3.data) === null || _err$response3$data === void 0 ? void 0 : _err$response3$data.error) || 'Failed to delete announcement'\n      });\n    }\n  };\n  const deletePoll = async id => {\n    if (!window.confirm('Are you sure you want to delete this poll?')) return;\n    try {\n      const userName = authHelpers.getUserName() || 'User';\n      await axios.delete(`${apiConfig.adminService}/polls/${id}`, {\n        headers: {\n          'X-User-Name': userName\n        }\n      });\n      setMessage({\n        type: 'success',\n        text: 'Poll deleted successfully.'\n      });\n      loadAll();\n    } catch (err) {\n      var _err$response4, _err$response4$data;\n      setMessage({\n        type: 'error',\n        text: (err === null || err === void 0 ? void 0 : (_err$response4 = err.response) === null || _err$response4 === void 0 ? void 0 : (_err$response4$data = _err$response4.data) === null || _err$response4$data === void 0 ? void 0 : _err$response4$data.error) || 'Failed to delete poll'\n      });\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(motion.div, {\n    initial: {\n      opacity: 0\n    },\n    animate: {\n      opacity: 1\n    },\n    className: \"space-y-8\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"text-3xl font-bold text-gray-800\",\n      children: \"Global Communications (ALL)\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 471,\n      columnNumber: 7\n    }, this), message && /*#__PURE__*/_jsxDEV(motion.div, {\n      className: `p-3 rounded ${message.type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`,\n      initial: {\n        y: -20,\n        opacity: 0\n      },\n      animate: {\n        y: 0,\n        opacity: 1\n      },\n      children: message.text\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 474,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"grid grid-cols-1 md:grid-cols-2 gap-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: createAnnouncement,\n        className: \"bg-white p-6 rounded-xl shadow-md border-l-4 border-indigo-500 space-y-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-xl font-semibold\",\n          children: \"Create Announcement\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 481,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"p-2 border rounded w-full\",\n          placeholder: \"Title\",\n          value: formAnn.title,\n          onChange: e => setFormAnn(p => ({\n            ...p,\n            title: e.target.value\n          })),\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 482,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          className: \"p-2 border rounded w-full h-24\",\n          placeholder: \"Content\",\n          value: formAnn.content,\n          onChange: e => setFormAnn(p => ({\n            ...p,\n            content: e.target.value\n          })),\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 483,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          className: \"p-2 border rounded w-full\",\n          value: formAnn.type,\n          onChange: e => setFormAnn(p => ({\n            ...p,\n            type: e.target.value\n          })),\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"GENERAL\",\n            children: \"GENERAL\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 485,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"URGENT\",\n            children: \"URGENT\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 486,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"POLICY\",\n            children: \"POLICY\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 487,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"EVENT\",\n            children: \"EVENT\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 488,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"UPDATE\",\n            children: \"UPDATE\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 489,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 484,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-end\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700\",\n            children: \"Post\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 492,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 491,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 480,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: createPoll,\n        className: \"bg-white p-6 rounded-xl shadow-md border-l-4 border-emerald-500 space-y-3\",\n        onKeyDown: e => {\n          if (e.key === 'Enter') e.preventDefault();\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-xl font-semibold\",\n          children: \"Create Poll\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 497,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"p-2 border rounded w-full\",\n          placeholder: \"Question\",\n          value: formPoll.question,\n          onChange: e => setFormPoll(p => ({\n            ...p,\n            question: e.target.value\n          })),\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 498,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"space-y-2\",\n          children: (formPoll.options || []).slice(0, 4).map((opt, idx) => {\n            var _formPoll$options, _formPoll$options2;\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex gap-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                className: \"p-2 border rounded w-full\",\n                placeholder: `Option ${idx + 1}`,\n                value: opt,\n                onChange: e => {\n                  const next = [...(formPoll.options || [])];\n                  next[idx] = e.target.value;\n                  setFormPoll(p => ({\n                    ...p,\n                    options: next\n                  }));\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 502,\n                columnNumber: 17\n              }, this), idx === (((_formPoll$options = formPoll.options) === null || _formPoll$options === void 0 ? void 0 : _formPoll$options.length) || 0) - 1 && (((_formPoll$options2 = formPoll.options) === null || _formPoll$options2 === void 0 ? void 0 : _formPoll$options2.length) || 0) < 4 && /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"px-2 border rounded\",\n                onClick: () => setFormPoll(p => ({\n                  ...p,\n                  options: [...(p.options || []), '']\n                })),\n                children: \"+\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 506,\n                columnNumber: 19\n              }, this)]\n            }, idx, true, {\n              fileName: _jsxFileName,\n              lineNumber: 501,\n              columnNumber: 15\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 499,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-end\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700\",\n            children: \"Launch\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 512,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 511,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 496,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 479,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-2xl font-semibold text-gray-800 border-b pb-2\",\n        children: \"Announcements\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 518,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(AnnouncementList, {\n        items: announcements,\n        onLike: likeAnnouncement,\n        onComment: commentAnnouncement,\n        onDelete: deleteAnnouncement,\n        drafts: commentDrafts,\n        setDrafts: setCommentDrafts,\n        userLikes: userLikes,\n        likeCounts: likeCounts,\n        comments: comments,\n        stompClient: (_stompRef$current = stompRef.current) === null || _stompRef$current === void 0 ? void 0 : _stompRef$current.chat\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 519,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 517,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-2xl font-semibold text-gray-800 border-b pb-2\",\n        children: \"Polls\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 523,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(PollList, {\n        items: polls,\n        resultsMap: pollResults,\n        onVote: votePoll,\n        onDelete: deletePoll,\n        choice: pollChoice,\n        setChoice: setPollChoice,\n        userVotes: userVotes\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 524,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 522,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 470,\n    columnNumber: 5\n  }, this);\n};\n_s(GlobalCommunications, \"xUi8GyHAxPmpILLKidlZTfRv2so=\");\n_c = GlobalCommunications;\nexport default GlobalCommunications;\nvar _c;\n$RefreshReg$(_c, \"GlobalCommunications\");","map":{"version":3,"names":["React","useEffect","useRef","useState","axios","motion","apiConfig","authHelpers","AnnouncementList","PollList","SockJS","Client","jsxDEV","_jsxDEV","GlobalCommunications","_s","_stompRef$current","announcements","setAnnouncements","polls","setPolls","message","setMessage","formAnn","setFormAnn","title","content","type","formPoll","setFormPoll","question","options","commentDrafts","setCommentDrafts","pollChoice","setPollChoice","pollResults","setPollResults","userLikes","setUserLikes","userVotes","setUserVotes","likeCounts","setLikeCounts","comments","setComments","stompRef","loadAll","console","log","announcementsData","pollsData","ra","get","adminService","data","error","rp","forEach","p","refreshPollResults","id","length","loadUserLikes","loadLikeCounts","loadComments","text","currentUser","getUserName","likes","batchSize","i","batch","slice","batchPromises","map","ann","base","chatService","replace","response","fetch","ok","status","liked","interactions","json","userLike","find","userName","batchResults","Promise","all","result","resolve","setTimeout","counts","count","allComments","commentList","filter","chatSocket","websocketUrl","adminSocket","adminWebsocketUrl","chatClient","webSocketFactory","reconnectDelay","adminClient","onConnect","subscribe","msg","v","JSON","parse","body","pollId","reaction","prev","announcementId","deletion","poll","activate","current","chat","admin","deactivate","connected","parseInt","res","results","totalVotes","optionCounts","createAnnouncement","e","preventDefault","post","toUpperCase","targetAudience","createdByName","err","_err$response","_err$response$data","createPoll","o","trim","Boolean","isActive","_err$response2","_err$response2$data","likeAnnouncement","method","headers","stringify","statusText","commentAnnouncement","String","votePoll","selected","voterName","selectedOption","deleteAnnouncement","window","confirm","delete","_err$response3","_err$response3$data","deletePoll","_err$response4","_err$response4$data","div","initial","opacity","animate","className","children","fileName","_jsxFileName","lineNumber","columnNumber","y","onSubmit","placeholder","value","onChange","target","required","onKeyDown","key","opt","idx","_formPoll$options","_formPoll$options2","next","onClick","items","onLike","onComment","onDelete","drafts","setDrafts","stompClient","resultsMap","onVote","choice","setChoice","_c","$RefreshReg$"],"sources":["C:/Users/HP/Desktop/Interacthub/frontend/src/components/admin/GlobalCommunications.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport axios from 'axios';\r\nimport { motion } from 'framer-motion';\r\nimport apiConfig from '../../config/api';\r\nimport { authHelpers } from '../../config/auth';\r\nimport AnnouncementList from '../shared/AnnouncementList';\r\nimport PollList from '../shared/PollList';\r\nimport SockJS from 'sockjs-client';\r\nimport { Client } from '@stomp/stompjs';\r\n\r\nconst GlobalCommunications = () => {\r\n  const [announcements, setAnnouncements] = useState([]);\r\n  const [polls, setPolls] = useState([]);\r\n  const [message, setMessage] = useState(null);\r\n\r\n  const [formAnn, setFormAnn] = useState({ title: '', content: '', type: 'GENERAL' });\r\n  const [formPoll, setFormPoll] = useState({ question: '', options: [''] });\r\n\r\n  const [commentDrafts, setCommentDrafts] = useState({});\r\n  const [pollChoice, setPollChoice] = useState({});\r\n  const [pollResults, setPollResults] = useState({});\r\n  const [userLikes, setUserLikes] = useState({}); // Track which announcements user has liked\r\n  const [userVotes, setUserVotes] = useState({}); // Track which polls user has voted on\r\n  const [likeCounts, setLikeCounts] = useState({}); // Track like counts for announcements\r\n  const [comments, setComments] = useState({}); // Track comments for announcements\r\n\r\n  const stompRef = useRef(null);\r\n\r\n  const loadAll = async () => {\r\n    try {\r\n      console.log('Loading communications...');\r\n      \r\n      // Try target-specific endpoint first, fallback to all announcements\r\n      let announcementsData = [];\r\n      let pollsData = [];\r\n      \r\n      try {\r\n        const ra = await axios.get(`${apiConfig.adminService}/announcements/target/ALL`);\r\n        announcementsData = ra.data || [];\r\n      } catch (error) {\r\n        console.log('Fallback: Loading all announcements...');\r\n        const ra = await axios.get(`${apiConfig.adminService}/announcements`);\r\n        announcementsData = ra.data || [];\r\n      }\r\n      \r\n      try {\r\n        const rp = await axios.get(`${apiConfig.adminService}/polls/target/ALL`);\r\n        pollsData = rp.data || [];\r\n      } catch (error) {\r\n        console.log('Fallback: Loading all polls...');\r\n        const rp = await axios.get(`${apiConfig.adminService}/polls`);\r\n        pollsData = rp.data || [];\r\n      }\r\n      \r\n      console.log('Announcements loaded:', announcementsData);\r\n      console.log('Polls loaded:', pollsData);\r\n      \r\n      setAnnouncements(announcementsData);\r\n      setPolls(pollsData);\r\n      pollsData.forEach(p => refreshPollResults(p.id));\r\n      \r\n      // Load additional data only if we have announcements\r\n      if (announcementsData && announcementsData.length > 0) {\r\n        // Load user's current like status for all announcements\r\n        loadUserLikes(announcementsData);\r\n        // Load like counts for all announcements\r\n        loadLikeCounts(announcementsData);\r\n        // Load comments for all announcements\r\n        loadComments(announcementsData);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading communications:', error);\r\n      setMessage({ type: 'error', text: `Failed to fetch communications: ${error.message}` });\r\n      // Set empty arrays on error\r\n      setAnnouncements([]);\r\n      setPolls([]);\r\n    }\r\n  };\r\n\r\n  const loadUserLikes = async (announcements) => {\r\n    const currentUser = authHelpers.getUserName() || 'User';\r\n    const likes = {};\r\n    \r\n    // If no announcements, return early\r\n    if (!announcements || announcements.length === 0) {\r\n      setUserLikes(likes);\r\n      return;\r\n    }\r\n    \r\n    // Process announcements in batches to avoid overwhelming the server\r\n    const batchSize = 3;\r\n    for (let i = 0; i < announcements.length; i += batchSize) {\r\n      const batch = announcements.slice(i, i + batchSize);\r\n      \r\n      const batchPromises = batch.map(async (ann) => {\r\n        try {\r\n          const base = apiConfig.chatService.replace('/api/chat','/api/interactions');\r\n          const response = await fetch(`${base}/announcement/${ann.id}/interactions`);\r\n          if (!response.ok) {\r\n            console.error(`Failed to load interactions for announcement ${ann.id}:`, response.status);\r\n            return { id: ann.id, liked: false };\r\n          }\r\n          const interactions = await response.json();\r\n          const userLike = interactions.find(i => \r\n            i.userName === currentUser && i.type === 'LIKE'\r\n          );\r\n          return { id: ann.id, liked: !!userLike };\r\n        } catch (error) {\r\n          console.error(`Error loading likes for announcement ${ann.id}:`, error);\r\n          return { id: ann.id, liked: false };\r\n        }\r\n      });\r\n      \r\n      try {\r\n        const batchResults = await Promise.all(batchPromises);\r\n        batchResults.forEach(result => {\r\n          likes[result.id] = result.liked;\r\n        });\r\n        \r\n        // Small delay between batches to prevent overwhelming the server\r\n        if (i + batchSize < announcements.length) {\r\n          await new Promise(resolve => setTimeout(resolve, 100));\r\n        }\r\n      } catch (error) {\r\n        console.error('Error processing batch:', error);\r\n        // Set all announcements in this batch to not liked\r\n        batch.forEach(ann => {\r\n          likes[ann.id] = false;\r\n        });\r\n      }\r\n    }\r\n    \r\n    setUserLikes(likes);\r\n  };\r\n\r\n  const loadLikeCounts = async (announcements) => {\r\n    const counts = {};\r\n    \r\n    // If no announcements, return early\r\n    if (!announcements || announcements.length === 0) {\r\n      setLikeCounts(counts);\r\n      return;\r\n    }\r\n    \r\n    // Process announcements in batches to avoid overwhelming the server\r\n    const batchSize = 5;\r\n    for (let i = 0; i < announcements.length; i += batchSize) {\r\n      const batch = announcements.slice(i, i + batchSize);\r\n      \r\n      const batchPromises = batch.map(async (ann) => {\r\n        try {\r\n          const base = apiConfig.chatService.replace('/api/chat','/api/interactions');\r\n          const response = await fetch(`${base}/announcement/${ann.id}/likes/count`);\r\n          if (!response.ok) {\r\n            console.error(`Failed to load like count for announcement ${ann.id}:`, response.status);\r\n            return { id: ann.id, count: 0 };\r\n          }\r\n          const result = await response.json();\r\n          return { id: ann.id, count: result.count || 0 };\r\n        } catch (error) {\r\n          console.error(`Error loading like count for announcement ${ann.id}:`, error);\r\n          return { id: ann.id, count: 0 };\r\n        }\r\n      });\r\n      \r\n      try {\r\n        const batchResults = await Promise.all(batchPromises);\r\n        batchResults.forEach(result => {\r\n          counts[result.id] = result.count;\r\n        });\r\n        \r\n        // Small delay between batches to prevent overwhelming the server\r\n        if (i + batchSize < announcements.length) {\r\n          await new Promise(resolve => setTimeout(resolve, 50));\r\n        }\r\n      } catch (error) {\r\n        console.error('Error processing like counts batch:', error);\r\n        // Set all announcements in this batch to 0 likes\r\n        batch.forEach(ann => {\r\n          counts[ann.id] = 0;\r\n        });\r\n      }\r\n    }\r\n    \r\n    setLikeCounts(counts);\r\n  };\r\n\r\n  const loadComments = async (announcements) => {\r\n    const allComments = {};\r\n    \r\n    // If no announcements, return early\r\n    if (!announcements || announcements.length === 0) {\r\n      setComments(allComments);\r\n      return;\r\n    }\r\n    \r\n    // Process announcements in batches to avoid overwhelming the server\r\n    const batchSize = 5;\r\n    for (let i = 0; i < announcements.length; i += batchSize) {\r\n      const batch = announcements.slice(i, i + batchSize);\r\n      \r\n      const batchPromises = batch.map(async (ann) => {\r\n        try {\r\n          const base = apiConfig.chatService.replace('/api/chat','/api/interactions');\r\n          const response = await fetch(`${base}/announcement/${ann.id}/interactions`);\r\n          if (!response.ok) {\r\n            console.error(`Failed to load comments for announcement ${ann.id}:`, response.status);\r\n            return { id: ann.id, comments: [] };\r\n          }\r\n          const interactions = await response.json();\r\n          const commentList = interactions.filter(i => i.type === 'COMMENT');\r\n          return { id: ann.id, comments: commentList };\r\n        } catch (error) {\r\n          console.error(`Error loading comments for announcement ${ann.id}:`, error);\r\n          return { id: ann.id, comments: [] };\r\n        }\r\n      });\r\n      \r\n      try {\r\n        const batchResults = await Promise.all(batchPromises);\r\n        batchResults.forEach(result => {\r\n          allComments[result.id] = result.comments;\r\n        });\r\n        \r\n        // Small delay between batches to prevent overwhelming the server\r\n        if (i + batchSize < announcements.length) {\r\n          await new Promise(resolve => setTimeout(resolve, 50));\r\n        }\r\n      } catch (error) {\r\n        console.error('Error processing comments batch:', error);\r\n        // Set all announcements in this batch to empty comments\r\n        batch.forEach(ann => {\r\n          allComments[ann.id] = [];\r\n        });\r\n      }\r\n    }\r\n    \r\n    setComments(allComments);\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadAll();\r\n    // Use chat service WebSocket for likes/comments, admin service WebSocket for deletions\r\n    const chatSocket = new SockJS(apiConfig.websocketUrl);\r\n    const adminSocket = new SockJS(apiConfig.adminWebsocketUrl);\r\n    const chatClient = new Client({ webSocketFactory: () => chatSocket, reconnectDelay: 3000 });\r\n    const adminClient = new Client({ webSocketFactory: () => adminSocket, reconnectDelay: 3000 });\r\n    \r\n    // Chat service WebSocket for likes/comments\r\n    chatClient.onConnect = () => {\r\n      chatClient.subscribe('/topic/announcements.new', () => loadAll());\r\n      chatClient.subscribe('/topic/polls.new', () => loadAll());\r\n      chatClient.subscribe('/topic/polls.votes', (msg) => {\r\n        try {\r\n          const v = JSON.parse(msg.body || '{}');\r\n          if (v?.pollId) refreshPollResults(v.pollId);\r\n        } catch {}\r\n      });\r\n      \r\n      // Subscribe to general announcement reactions\r\n      chatClient.subscribe('/topic/announcements.reactions', (msg) => {\r\n        try {\r\n          const reaction = JSON.parse(msg.body || '{}');\r\n          if (reaction.type === 'LIKE') {\r\n            // Update like status for the specific announcement\r\n            setUserLikes(prev => ({ ...prev, [reaction.announcementId]: reaction.liked }));\r\n            // Also refresh the data to get updated like counts\r\n            loadAll();\r\n          } else if (reaction.type === 'COMMENT') {\r\n            // Refresh comments when new comment is added\r\n            console.log('Comment reaction received:', reaction);\r\n            // Refresh all data to get updated comments\r\n            loadAll();\r\n          }\r\n        } catch (error) {\r\n          console.error('Error processing announcement reaction:', error);\r\n        }\r\n      });\r\n    };\r\n    \r\n    // Admin service WebSocket for deletions\r\n    adminClient.onConnect = () => {\r\n      // Subscribe to deletion events\r\n      adminClient.subscribe('/topic/announcements.deleted', (msg) => {\r\n        try {\r\n          const deletion = JSON.parse(msg.body || '{}');\r\n          console.log('Announcement deleted:', deletion);\r\n          // Remove the deleted announcement from the list\r\n          setAnnouncements(prev => prev.filter(ann => ann.id !== deletion.id));\r\n        } catch (error) {\r\n          console.error('Error processing announcement deletion:', error);\r\n        }\r\n      });\r\n      \r\n      adminClient.subscribe('/topic/polls.deleted', (msg) => {\r\n        try {\r\n          const deletion = JSON.parse(msg.body || '{}');\r\n          console.log('Poll deleted:', deletion);\r\n          // Remove the deleted poll from the list\r\n          setPolls(prev => prev.filter(poll => poll.id !== deletion.id));\r\n        } catch (error) {\r\n          console.error('Error processing poll deletion:', error);\r\n        }\r\n      });\r\n    };\r\n    \r\n    chatClient.activate();\r\n    adminClient.activate();\r\n    stompRef.current = { chat: chatClient, admin: adminClient };\r\n    return () => {\r\n      chatClient.deactivate();\r\n      adminClient.deactivate();\r\n    };\r\n  }, []);\r\n\r\n  // Subscribe to individual announcement like and comment updates when announcements change\r\n  useEffect(() => {\r\n    if (stompRef.current && stompRef.current.chat && stompRef.current.chat.connected) {\r\n      announcements.forEach(ann => {\r\n        // Subscribe to likes\r\n        stompRef.current.chat.subscribe(`/topic/announcement.${ann.id}.likes`, (msg) => {\r\n          const count = parseInt(msg.body) || 0;\r\n          // Refresh all data to get updated like counts\r\n          loadAll();\r\n        });\r\n        \r\n        // Subscribe to comments\r\n        stompRef.current.chat.subscribe(`/topic/announcement.${ann.id}.comments`, (msg) => {\r\n          console.log('New comment received for announcement', ann.id, ':', msg.body);\r\n          // Refresh all data to get updated comments\r\n          loadAll();\r\n        });\r\n      });\r\n    }\r\n  }, [announcements]);\r\n\r\n  const refreshPollResults = async (pollId) => {\r\n    try {\r\n      const base = apiConfig.chatService.replace('/api/chat','/api/interactions');\r\n      const res = await fetch(`${base}/poll/${pollId}/results`);\r\n      const results = await res.json();\r\n      setPollResults(prev => ({ ...prev, [pollId]: results || { totalVotes: 0, optionCounts: {} } }));\r\n    } catch {}\r\n  };\r\n\r\n  // Create ALL-only\r\n  const createAnnouncement = async (e) => {\r\n    e.preventDefault();\r\n    try {\r\n      await axios.post(`${apiConfig.adminService}/announcements`, {\r\n        title: formAnn.title,\r\n        content: formAnn.content,\r\n        type: (formAnn.type || 'GENERAL').toUpperCase(),\r\n        targetAudience: 'ALL',\r\n        createdByName: authHelpers.getUserName() || 'User'\r\n      });\r\n      setFormAnn({ title: '', content: '', type: 'GENERAL' });\r\n      setMessage({ type: 'success', text: 'Announcement posted.' });\r\n      loadAll();\r\n    } catch (err) {\r\n      setMessage({ type: 'error', text: err?.response?.data?.error || 'Failed to post announcement' });\r\n    }\r\n  };\r\n\r\n  const createPoll = async (e) => {\r\n    e.preventDefault();\r\n    const options = (formPoll.options || []).map(o => (o || '').trim()).filter(Boolean);\r\n    if (options.length < 2) { setMessage({ type: 'error', text: 'A poll needs at least two options.' }); return; }\r\n    try {\r\n      await axios.post(`${apiConfig.adminService}/polls`, {\r\n        question: formPoll.question,\r\n        options,\r\n        targetAudience: 'ALL',\r\n        createdByName: authHelpers.getUserName() || 'User',\r\n        isActive: true\r\n      });\r\n      setFormPoll({ question: '', options: [''] });\r\n      setMessage({ type: 'success', text: 'Poll created.' });\r\n      loadAll();\r\n    } catch (err) {\r\n      setMessage({ type: 'error', text: err?.response?.data?.error || 'Failed to create poll' });\r\n    }\r\n  };\r\n\r\n  // Interactions to chat-service (name-only)\r\n  const likeAnnouncement = async (ann) => {\r\n    try {\r\n      const base = apiConfig.chatService.replace('/api/chat','/api/interactions');\r\n      const response = await fetch(`${base}/announcement/like`, {\r\n        method: 'POST', headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ announcementId: ann.id, userName: authHelpers.getUserName() || 'User', type: 'LIKE' })\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        console.error('Like request failed:', response.status, response.statusText);\r\n        return;\r\n      }\r\n      \r\n      const result = await response.json();\r\n      console.log('Like response:', result);\r\n      \r\n      // Update the like status for this announcement\r\n      setUserLikes(prev => ({ ...prev, [ann.id]: result.liked }));\r\n      \r\n      // Also refresh the like count\r\n      loadAll();\r\n    } catch (error) {\r\n      console.error('Like error:', error);\r\n    }\r\n  };\r\n\r\n  const commentAnnouncement = async (ann, text) => {\r\n    const content = String(text || '').trim();\r\n    if (!content) return;\r\n    try {\r\n      const base = apiConfig.chatService.replace('/api/chat','/api/interactions');\r\n      await fetch(`${base}/announcement/comment`, {\r\n        method: 'POST', headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ announcementId: ann.id, userName: authHelpers.getUserName() || 'User', content, type: 'COMMENT' })\r\n      });\r\n      setCommentDrafts(p => ({ ...p, [ann.id]: '' }));\r\n      // Refresh comments for this announcement\r\n      loadComments([ann]);\r\n    } catch {}\r\n  };\r\n\r\n  const votePoll = async (poll, selected) => {\r\n    if (!selected) return;\r\n    try {\r\n      const base = apiConfig.chatService.replace('/api/chat','/api/interactions');\r\n      await fetch(`${base}/poll/vote`, {\r\n        method: 'POST', headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ pollId: poll.id, voterName: authHelpers.getUserName() || 'User', selectedOption: selected })\r\n      });\r\n      setPollChoice(p => ({ ...p, [poll.id]: '' }));\r\n      setUserVotes(p => ({ ...p, [poll.id]: selected }));\r\n      refreshPollResults(poll.id);\r\n    } catch {}\r\n  };\r\n\r\n  const deleteAnnouncement = async (id) => {\r\n    if (!window.confirm('Are you sure you want to delete this announcement?')) return;\r\n    try {\r\n      const userName = authHelpers.getUserName() || 'User';\r\n      await axios.delete(`${apiConfig.adminService}/announcements/${id}`, {\r\n        headers: { 'X-User-Name': userName }\r\n      });\r\n      setMessage({ type: 'success', text: 'Announcement deleted successfully.' });\r\n      loadAll();\r\n    } catch (err) {\r\n      setMessage({ type: 'error', text: err?.response?.data?.error || 'Failed to delete announcement' });\r\n    }\r\n  };\r\n\r\n  const deletePoll = async (id) => {\r\n    if (!window.confirm('Are you sure you want to delete this poll?')) return;\r\n    try {\r\n      const userName = authHelpers.getUserName() || 'User';\r\n      await axios.delete(`${apiConfig.adminService}/polls/${id}`, {\r\n        headers: { 'X-User-Name': userName }\r\n      });\r\n      setMessage({ type: 'success', text: 'Poll deleted successfully.' });\r\n      loadAll();\r\n    } catch (err) {\r\n      setMessage({ type: 'error', text: err?.response?.data?.error || 'Failed to delete poll' });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className=\"space-y-8\">\r\n      <h1 className=\"text-3xl font-bold text-gray-800\">Global Communications (ALL)</h1>\r\n\r\n      {message && (\r\n        <motion.div className={`p-3 rounded ${message.type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`} initial={{ y: -20, opacity: 0 }} animate={{ y: 0, opacity: 1 }}>\r\n          {message.text}\r\n        </motion.div>\r\n      )}\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n        <form onSubmit={createAnnouncement} className=\"bg-white p-6 rounded-xl shadow-md border-l-4 border-indigo-500 space-y-3\">\r\n          <h2 className=\"text-xl font-semibold\">Create Announcement</h2>\r\n          <input className=\"p-2 border rounded w-full\" placeholder=\"Title\" value={formAnn.title} onChange={e => setFormAnn(p => ({ ...p, title: e.target.value }))} required />\r\n          <textarea className=\"p-2 border rounded w-full h-24\" placeholder=\"Content\" value={formAnn.content} onChange={e => setFormAnn(p => ({ ...p, content: e.target.value }))} required />\r\n          <select className=\"p-2 border rounded w-full\" value={formAnn.type} onChange={e => setFormAnn(p => ({ ...p, type: e.target.value }))}>\r\n            <option value=\"GENERAL\">GENERAL</option>\r\n            <option value=\"URGENT\">URGENT</option>\r\n            <option value=\"POLICY\">POLICY</option>\r\n            <option value=\"EVENT\">EVENT</option>\r\n            <option value=\"UPDATE\">UPDATE</option>\r\n          </select>\r\n          <div className=\"flex justify-end\">\r\n            <button className=\"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700\">Post</button>\r\n          </div>\r\n        </form>\r\n\r\n        <form onSubmit={createPoll} className=\"bg-white p-6 rounded-xl shadow-md border-l-4 border-emerald-500 space-y-3\" onKeyDown={(e) => { if (e.key === 'Enter') e.preventDefault(); }}>\r\n          <h2 className=\"text-xl font-semibold\">Create Poll</h2>\r\n          <input className=\"p-2 border rounded w-full\" placeholder=\"Question\" value={formPoll.question} onChange={e => setFormPoll(p => ({ ...p, question: e.target.value }))} required />\r\n          <div className=\"space-y-2\">\r\n            {(formPoll.options || []).slice(0, 4).map((opt, idx) => (\r\n              <div key={idx} className=\"flex gap-2\">\r\n                <input className=\"p-2 border rounded w-full\" placeholder={`Option ${idx + 1}`} value={opt} onChange={e => {\r\n                  const next = [...(formPoll.options || [])]; next[idx] = e.target.value; setFormPoll(p => ({ ...p, options: next }));\r\n                }} />\r\n                {idx === (formPoll.options?.length || 0) - 1 && (formPoll.options?.length || 0) < 4 && (\r\n                  <button type=\"button\" className=\"px-2 border rounded\" onClick={() => setFormPoll(p => ({ ...p, options: [...(p.options || []), ''] }))}>+</button>\r\n                )}\r\n              </div>\r\n            ))}\r\n          </div>\r\n          <div className=\"flex justify-end\">\r\n            <button className=\"px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700\">Launch</button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n\r\n      <div>\r\n        <h2 className=\"text-2xl font-semibold text-gray-800 border-b pb-2\">Announcements</h2>\r\n        <AnnouncementList items={announcements} onLike={likeAnnouncement} onComment={commentAnnouncement} onDelete={deleteAnnouncement} drafts={commentDrafts} setDrafts={setCommentDrafts} userLikes={userLikes} likeCounts={likeCounts} comments={comments} stompClient={stompRef.current?.chat} />\r\n      </div>\r\n\r\n      <div>\r\n        <h2 className=\"text-2xl font-semibold text-gray-800 border-b pb-2\">Polls</h2>\r\n        <PollList items={polls} resultsMap={pollResults} onVote={votePoll} onDelete={deletePoll} choice={pollChoice} setChoice={setPollChoice} userVotes={userVotes} />\r\n      </div>\r\n    </motion.div>\r\n  );\r\n};\r\n\r\nexport default GlobalCommunications;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}