{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\HP\\\\Desktop\\\\Interacthub\\\\frontend\\\\src\\\\components\\\\common\\\\VideoCallComponent.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport SockJS from 'sockjs-client';\nimport { Client } from '@stomp/stompjs';\nimport apiConfig from '../../config/api';\nimport { authHelpers } from '../../config/auth';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst VideoCallComponent = ({\n  channelId,\n  userId,\n  userName,\n  autoStart = false,\n  prefetchMedia = false\n}) => {\n  _s();\n  const [isCallActive, setIsCallActive] = useState(false);\n  const [isVideoEnabled, setIsVideoEnabled] = useState(true);\n  const [isAudioEnabled, setIsAudioEnabled] = useState(true);\n  const [participants, setParticipants] = useState([]);\n  const [stompClient, setStompClient] = useState(null);\n  const [permissionStatus, setPermissionStatus] = useState('idle'); // idle, pending, granted, denied\n  const [permissionError, setPermissionError] = useState('');\n  const [debugMsg, setDebugMsg] = useState('');\n  const addDebug = msg => {\n    console.log(msg);\n    setDebugMsg(msg);\n  };\n\n  // ICE servers (STUN + optional TURN from env)\n  const iceServers = React.useMemo(() => {\n    const servers = [{\n      urls: 'stun:stun.l.google.com:19302'\n    }, {\n      urls: 'stun:stun1.l.google.com:19302'\n    }];\n    const turnUrl = process.env.REACT_APP_TURN_URL;\n    const turnUser = process.env.REACT_APP_TURN_USERNAME;\n    const turnCred = process.env.REACT_APP_TURN_CREDENTIAL;\n    if (turnUrl && turnUrl.trim()) {\n      const entry = {\n        urls: turnUrl.trim()\n      };\n      if (turnUser) entry.username = turnUser;\n      if (turnCred) entry.credential = turnCred;\n      servers.push(entry);\n      addDebug('[ice] TURN added: ' + turnUrl);\n    }\n    return servers;\n  }, []);\n  const localVideoRef = useRef(null);\n  const remoteVideoRef = useRef(null);\n  const peerConnectionRef = useRef(null);\n  const localStreamRef = useRef(null);\n  const stompClientRef = useRef(null);\n  const isConnectedRef = useRef(false);\n  const pendingSignalsRef = useRef([]);\n  const flushPendingSignals = () => {\n    if (!isConnectedRef.current || !stompClientRef.current) return;\n    while (pendingSignalsRef.current.length) {\n      const msg = pendingSignalsRef.current.shift();\n      try {\n        addDebug('[signal:flush] ' + JSON.stringify(msg));\n        stompClientRef.current.publish({\n          destination: `/app/chat.sendSignal`,\n          body: JSON.stringify({\n            channelId,\n            signal: msg\n          })\n        });\n      } catch {}\n    }\n  };\n  const requestPermissions = async () => {\n    try {\n      // If we already have a stream, reuse it\n      if (localStreamRef.current && localStreamRef.current.active) {\n        addDebug('[media] Reusing existing stream');\n        setPermissionStatus('granted');\n        return true;\n      }\n\n      // Stop any existing tracks first\n      if (localStreamRef.current) {\n        localStreamRef.current.getTracks().forEach(track => track.stop());\n        localStreamRef.current = null;\n      }\n      setPermissionStatus('pending');\n      setPermissionError('');\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          width: {\n            ideal: 1280\n          },\n          height: {\n            ideal: 720\n          }\n        },\n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true\n        }\n      });\n      localStreamRef.current = stream;\n      if (localVideoRef.current) {\n        localVideoRef.current.srcObject = stream;\n        try {\n          await localVideoRef.current.play();\n        } catch (e) {\n          addDebug('[video] Play error: ' + e.message);\n        }\n      }\n      setPermissionStatus('granted');\n      addDebug('[media] Permissions granted');\n      return true;\n    } catch (error) {\n      console.error('Permission denied:', error);\n      setPermissionStatus('denied');\n      let errorMsg = error.message;\n      if (error.name === 'NotReadableError') {\n        errorMsg = 'Device in use by another application. Please close other apps using your camera/microphone.';\n      } else if (error.name === 'NotAllowedError') {\n        errorMsg = 'Permission denied. Please allow camera and microphone access.';\n      } else if (error.name === 'NotFoundError') {\n        errorMsg = 'No camera or microphone found. Please connect a device.';\n      }\n      setPermissionError(errorMsg);\n      addDebug('[media] Error: ' + errorMsg);\n      return false;\n    }\n  };\n  const initializeWebSocket = useCallback(() => {\n    addDebug('[ws] initializing for channel ' + channelId);\n    const socket = new SockJS(apiConfig.websocketUrl);\n    const client = new Client({\n      webSocketFactory: () => socket,\n      debug: str => addDebug('[stomp] ' + str),\n      reconnectDelay: 5000\n    });\n    client.onConnect = () => {\n      addDebug('[stomp] Connected');\n      stompClientRef.current = client;\n      setStompClient(client);\n      isConnectedRef.current = true;\n\n      // Subscribe to signaling\n      client.subscribe(`/topic/channel.${channelId}.signal`, msg => {\n        addDebug('[ws<-] ' + msg.body);\n        handleSignalingMessage(msg);\n      });\n      client.subscribe(`/topic/channel.${channelId}.call`, handleCallEvent);\n      flushPendingSignals();\n    };\n    client.onStompError = () => {\n      addDebug('[stomp] error');\n      isConnectedRef.current = false;\n    };\n    client.onWebSocketClose = () => {\n      addDebug('[ws] closed');\n      isConnectedRef.current = false;\n    };\n    client.activate();\n  }, [channelId]);\n  useEffect(() => {\n    initializeWebSocket();\n    if (prefetchMedia && !localStreamRef.current) {\n      (async () => {\n        const ok = await requestPermissions();\n        if (ok) {\n          // Show local preview even before negotiation\n          setIsCallActive(true);\n          setParticipants(prev => prev.length ? prev : [{\n            id: userId,\n            name: userName\n          }]);\n        }\n      })();\n    }\n    if (autoStart) {\n      // try to request permissions early; then start call\n      (async () => {\n        // If we already have a stream, don't re-prompt\n        let ok = true;\n        if (!localStreamRef.current) {\n          ok = await requestPermissions();\n        } else {\n          setPermissionStatus('granted');\n        }\n        if (ok && !isCallActive && channelId) {\n          await startCall();\n        }\n      })();\n    }\n    return () => {\n      if (stompClientRef.current) {\n        stompClientRef.current.deactivate();\n      }\n      if (localStreamRef.current) {\n        localStreamRef.current.getTracks().forEach(track => track.stop());\n      }\n    };\n  }, [channelId, initializeWebSocket, autoStart]);\n  const handleSignalingMessage = message => {\n    const payload = typeof (message === null || message === void 0 ? void 0 : message.body) === 'string' ? JSON.parse(message.body) : message;\n    const signal = payload !== null && payload !== void 0 && payload.type ? payload : (payload === null || payload === void 0 ? void 0 : payload.signal) || {};\n    const fromUserId = (payload === null || payload === void 0 ? void 0 : payload.userId) || (signal === null || signal === void 0 ? void 0 : signal.userId);\n    // Ignore echoes of our own messages\n    if (fromUserId && String(fromUserId) === String(userId)) {\n      addDebug('[ws<-] ignored self message ' + signal.type);\n      return;\n    }\n    if (signal.type === 'offer') {\n      handleOffer(signal.offer);\n    } else if (signal.type === 'answer') {\n      var _peerConnectionRef$cu;\n      // Apply answer only if we are in the right state\n      const state = (_peerConnectionRef$cu = peerConnectionRef.current) === null || _peerConnectionRef$cu === void 0 ? void 0 : _peerConnectionRef$cu.signalingState;\n      if (state !== 'have-local-offer') {\n        addDebug('[rtc] skip answer; state=' + state);\n        return;\n      }\n      handleAnswer(signal.answer);\n    } else if (signal.type === 'ice-candidate') {\n      handleIceCandidate(signal.candidate);\n    }\n  };\n  const handleCallEvent = message => {\n    const event = JSON.parse(message.body);\n    if (event.type === 'user-joined') {\n      setParticipants(prev => [...prev, {\n        id: event.userId,\n        name: event.userName\n      }]);\n    } else if (event.type === 'user-left') {\n      setParticipants(prev => prev.filter(p => p.id !== event.userId));\n    }\n  };\n  const startCall = async () => {\n    if (!channelId) {\n      alert('Please select a recipient first');\n      return;\n    }\n\n    // Ensure signaling connected before producing offer/ICE\n    if (!isConnectedRef.current) {\n      // wait briefly for connection\n      await new Promise(resolve => setTimeout(resolve, 300));\n    }\n    const hasPermissions = localStreamRef.current ? true : await requestPermissions();\n    if (!hasPermissions) {\n      alert('Camera and microphone permissions are required for video calls');\n      return;\n    }\n    try {\n      setIsCallActive(true);\n\n      // Create peer connection\n      peerConnectionRef.current = new RTCPeerConnection({\n        iceServers\n      });\n\n      // Add tracks to peer connection\n      if (localStreamRef.current) {\n        localStreamRef.current.getTracks().forEach(track => {\n          peerConnectionRef.current.addTrack(track, localStreamRef.current);\n        });\n      }\n\n      // Handle remote stream\n      peerConnectionRef.current.ontrack = event => {\n        if (remoteVideoRef.current) {\n          remoteVideoRef.current.srcObject = event.streams[0];\n          try {\n            var _remoteVideoRef$curre, _remoteVideoRef$curre2;\n            (_remoteVideoRef$curre = (_remoteVideoRef$curre2 = remoteVideoRef.current).play) === null || _remoteVideoRef$curre === void 0 ? void 0 : _remoteVideoRef$curre.call(_remoteVideoRef$curre2);\n          } catch {}\n        }\n      };\n\n      // Handle ICE candidates\n      peerConnectionRef.current.onicecandidate = event => {\n        if (event.candidate) {\n          sendSignalingMessage({\n            type: 'ice-candidate',\n            candidate: event.candidate,\n            userId: userId\n          });\n        }\n      };\n\n      // Create and send offer\n      const offer = await peerConnectionRef.current.createOffer();\n      await peerConnectionRef.current.setLocalDescription(offer);\n      sendSignalingMessage({\n        type: 'offer',\n        offer: offer,\n        userId: userId\n      });\n\n      // Notify others about call start\n      if (stompClientRef.current && isConnectedRef.current) {\n        stompClientRef.current.publish({\n          destination: `/app/chat.sendCallEvent`,\n          body: JSON.stringify({\n            channelId: channelId,\n            type: 'call-started',\n            userId: userId,\n            userName: userName\n          })\n        });\n      }\n      setIsCallActive(true);\n      setParticipants([{\n        id: userId,\n        name: userName\n      }]);\n    } catch (error) {\n      console.error('Error starting call:', error);\n      alert('Could not access camera/microphone. Please check permissions.');\n    }\n  };\n  const endCall = () => {\n    addDebug('[call] Ending call');\n\n    // Stop all media tracks\n    if (localStreamRef.current) {\n      localStreamRef.current.getTracks().forEach(track => {\n        track.stop();\n        addDebug('[media] Stopped track: ' + track.kind);\n      });\n      localStreamRef.current = null;\n    }\n\n    // Close peer connection\n    if (peerConnectionRef.current) {\n      peerConnectionRef.current.close();\n      peerConnectionRef.current = null;\n    }\n\n    // Clear video elements\n    if (localVideoRef.current) {\n      localVideoRef.current.srcObject = null;\n    }\n    if (remoteVideoRef.current) {\n      remoteVideoRef.current.srcObject = null;\n    }\n\n    // Notify others about call end\n    if (stompClientRef.current && isConnectedRef.current) {\n      try {\n        stompClientRef.current.publish({\n          destination: `/app/chat.sendCallEvent`,\n          body: JSON.stringify({\n            channelId: channelId,\n            type: 'call-ended',\n            userId: userId\n          })\n        });\n      } catch (e) {\n        addDebug('[ws] Error sending call-ended: ' + e.message);\n      }\n    }\n    setIsCallActive(false);\n    setParticipants([]);\n    setPermissionStatus('idle');\n    setIsVideoEnabled(true);\n    setIsAudioEnabled(true);\n  };\n  const toggleVideo = () => {\n    if (localStreamRef.current) {\n      const videoTrack = localStreamRef.current.getVideoTracks()[0];\n      if (videoTrack) {\n        videoTrack.enabled = !isVideoEnabled;\n        setIsVideoEnabled(!isVideoEnabled);\n      }\n    }\n  };\n  const toggleAudio = () => {\n    if (localStreamRef.current) {\n      const audioTrack = localStreamRef.current.getAudioTracks()[0];\n      if (audioTrack) {\n        audioTrack.enabled = !isAudioEnabled;\n        setIsAudioEnabled(!isAudioEnabled);\n      }\n    }\n  };\n  const handleOffer = async offer => {\n    try {\n      addDebug('[rtc<-] got offer');\n      if (!peerConnectionRef.current) {\n        addDebug('[rtc] No connection: callee building PC and starting local stream...');\n        peerConnectionRef.current = new RTCPeerConnection({\n          iceServers\n        });\n        peerConnectionRef.current.ontrack = event => {\n          if (remoteVideoRef.current) {\n            remoteVideoRef.current.srcObject = event.streams[0];\n          }\n        };\n        peerConnectionRef.current.onicecandidate = event => {\n          if (event.candidate) {\n            addDebug('[rtc ICE->]', event.candidate);\n            sendSignalingMessage({\n              type: 'ice-candidate',\n              candidate: event.candidate,\n              userId: userId\n            });\n          }\n        };\n        if (!localStreamRef.current) {\n          const ok = await requestPermissions();\n          if (!ok) {\n            addDebug('[media] denied');\n            return;\n          }\n        }\n        if (localStreamRef.current) {\n          localStreamRef.current.getTracks().forEach(track => {\n            peerConnectionRef.current.addTrack(track, localStreamRef.current);\n          });\n        }\n        setIsCallActive(true);\n        setParticipants(prev => prev.length ? prev : [{\n          id: userId,\n          name: userName\n        }]);\n      }\n      await peerConnectionRef.current.setRemoteDescription(offer);\n      addDebug('[rtc] Creating answer...');\n      const answer = await peerConnectionRef.current.createAnswer();\n      await peerConnectionRef.current.setLocalDescription(answer);\n      sendSignalingMessage({\n        type: 'answer',\n        answer: answer,\n        userId: userId\n      });\n      addDebug('[rtc->] Sent answer');\n    } catch (error) {\n      addDebug('[rtc] offer ERROR: ' + error.message);\n      console.error('Error handling offer:', error);\n      setDebugMsg('Offer negotiation failed: ' + error.message);\n    }\n  };\n  const handleAnswer = async answer => {\n    try {\n      addDebug('[rtc<-] got answer');\n      await peerConnectionRef.current.setRemoteDescription(answer);\n      addDebug('[rtc] Set remotedesc (answer)');\n    } catch (error) {\n      addDebug('[rtc] answer ERROR: ' + error.message);\n      console.error('Error handling answer:', error);\n    }\n  };\n  const handleIceCandidate = async candidate => {\n    try {\n      addDebug('[rtc<-] got ICE candidate');\n      await peerConnectionRef.current.addIceCandidate(candidate);\n      addDebug('[rtc] ICE add OK');\n    } catch (error) {\n      addDebug('[rtc] ICE ERROR: ' + error.message);\n      console.error('Error handling ICE candidate:', error);\n    }\n  };\n  const sendSignalingMessage = message => {\n    if (stompClientRef.current && isConnectedRef.current) {\n      try {\n        addDebug('[ws->] ' + JSON.stringify(message));\n        stompClientRef.current.publish({\n          destination: `/app/chat.sendSignal`,\n          body: JSON.stringify({\n            channelId,\n            signal: message\n          })\n        });\n      } catch (e) {\n        pendingSignalsRef.current.push(message);\n        addDebug('[ws~queue on error] ' + JSON.stringify(message));\n      }\n    } else {\n      pendingSignalsRef.current.push(message);\n      addDebug('[ws~queue, not connected] ' + JSON.stringify(message));\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"bg-white rounded-lg shadow-md p-6\",\n    children: [debugMsg && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-2 p-2 bg-yellow-100 text-yellow-900 rounded text-xs\",\n      children: debugMsg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 450,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n      className: \"text-xl font-semibold mb-4 flex items-center\",\n      children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n        className: \"w-6 h-6 mr-2\",\n        fill: \"none\",\n        stroke: \"currentColor\",\n        viewBox: \"0 0 24 24\",\n        children: /*#__PURE__*/_jsxDEV(\"path\", {\n          strokeLinecap: \"round\",\n          strokeLinejoin: \"round\",\n          strokeWidth: 2,\n          d: \"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 456,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 455,\n        columnNumber: 9\n      }, this), \"Video Call - \", channelId]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 454,\n      columnNumber: 7\n    }, this), permissionStatus === 'denied' && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-start\",\n        children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n          className: \"w-6 h-6 text-red-500 mr-3 flex-shrink-0 mt-0.5\",\n          fill: \"none\",\n          stroke: \"currentColor\",\n          viewBox: \"0 0 24 24\",\n          children: /*#__PURE__*/_jsxDEV(\"path\", {\n            strokeLinecap: \"round\",\n            strokeLinejoin: \"round\",\n            strokeWidth: 2,\n            d: \"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 466,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 465,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex-1\",\n          children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n            className: \"text-red-800 font-medium\",\n            children: \"Camera/Microphone Access Denied\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 469,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-red-600 text-sm mt-1\",\n            children: permissionError || 'Please allow camera and microphone access in your browser settings to use video calls.'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 470,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-3 space-y-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: requestPermissions,\n              className: \"px-4 py-2 bg-red-600 text-white text-sm rounded hover:bg-red-700 mr-2\",\n              children: \"Try Again\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 474,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => {\n                setPermissionStatus('idle');\n                setPermissionError('');\n              },\n              className: \"px-4 py-2 bg-gray-200 text-gray-700 text-sm rounded hover:bg-gray-300\",\n              children: \"Cancel\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 480,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 473,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-3 text-xs text-red-700 bg-red-100 p-2 rounded\",\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Troubleshooting:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 491,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n              className: \"list-disc list-inside mt-1 space-y-1\",\n              children: [/*#__PURE__*/_jsxDEV(\"li\", {\n                children: \"Close other apps using your camera/microphone (Zoom, Teams, etc.)\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 493,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n                children: \"Check browser permissions in Settings\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 494,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n                children: \"Reload the page and try again\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 495,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n                children: \"Make sure your device is properly connected\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 496,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 492,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 490,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 468,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 464,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 463,\n      columnNumber: 9\n    }, this), permissionStatus === 'pending' && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n          className: \"w-5 h-5 text-yellow-500 mr-2 animate-spin\",\n          fill: \"none\",\n          stroke: \"currentColor\",\n          viewBox: \"0 0 24 24\",\n          children: /*#__PURE__*/_jsxDEV(\"path\", {\n            strokeLinecap: \"round\",\n            strokeLinejoin: \"round\",\n            strokeWidth: 2,\n            d: \"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 508,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 507,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-yellow-800\",\n          children: \"Requesting camera and microphone permissions...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 510,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 506,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 505,\n      columnNumber: 9\n    }, this), !isCallActive ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-center py-8\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mb-4\",\n        children: /*#__PURE__*/_jsxDEV(\"svg\", {\n          className: \"w-16 h-16 mx-auto text-gray-400\",\n          fill: \"none\",\n          stroke: \"currentColor\",\n          viewBox: \"0 0 24 24\",\n          children: /*#__PURE__*/_jsxDEV(\"path\", {\n            strokeLinecap: \"round\",\n            strokeLinejoin: \"round\",\n            strokeWidth: 2,\n            d: \"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 519,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 518,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 517,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: startCall,\n        className: \"bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 flex items-center mx-auto\",\n        children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n          className: \"w-5 h-5 mr-2\",\n          fill: \"none\",\n          stroke: \"currentColor\",\n          viewBox: \"0 0 24 24\",\n          children: /*#__PURE__*/_jsxDEV(\"path\", {\n            strokeLinecap: \"round\",\n            strokeLinejoin: \"round\",\n            strokeWidth: 2,\n            d: \"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 527,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 526,\n          columnNumber: 13\n        }, this), \"Start Video Call\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 522,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 516,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"space-y-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"grid grid-cols-1 md:grid-cols-2 gap-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative\",\n          children: [/*#__PURE__*/_jsxDEV(\"video\", {\n            ref: localVideoRef,\n            autoPlay: true,\n            muted: true,\n            className: \"w-full h-48 bg-gray-900 rounded-lg\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 537,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"absolute bottom-2 left-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-sm\",\n            children: \"You\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 543,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 536,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative\",\n          children: [/*#__PURE__*/_jsxDEV(\"video\", {\n            ref: remoteVideoRef,\n            autoPlay: true,\n            className: \"w-full h-48 bg-gray-900 rounded-lg\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 549,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"absolute bottom-2 left-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-sm\",\n            children: \"Remote\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 554,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 548,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 535,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex justify-center space-x-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: toggleAudio,\n          className: `p-3 rounded-full ${isAudioEnabled ? 'bg-green-600 text-white' : 'bg-red-600 text-white'}`,\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            className: \"w-6 h-6\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            viewBox: \"0 0 24 24\",\n            children: isAudioEnabled ? /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: 2,\n              d: \"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 570,\n              columnNumber: 19\n            }, this) : /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: 2,\n              d: \"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 572,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 568,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 562,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: toggleVideo,\n          className: `p-3 rounded-full ${isVideoEnabled ? 'bg-green-600 text-white' : 'bg-red-600 text-white'}`,\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            className: \"w-6 h-6\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            viewBox: \"0 0 24 24\",\n            children: isVideoEnabled ? /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: 2,\n              d: \"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 585,\n              columnNumber: 19\n            }, this) : /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: 2,\n              d: \"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 587,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 583,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 577,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: endCall,\n          className: \"p-3 bg-red-600 text-white rounded-full hover:bg-red-700\",\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            className: \"w-6 h-6\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            viewBox: \"0 0 24 24\",\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: 2,\n              d: \"M6 18L18 6M6 6l12 12\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 597,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 596,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 592,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 561,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-gray-50 p-3 rounded-lg\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          className: \"text-sm font-medium text-gray-700 mb-2\",\n          children: [\"Participants (\", participants.length, \")\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 604,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex flex-wrap gap-2\",\n          children: participants.map(participant => /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full\",\n            children: participant.name\n          }, participant.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 609,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 607,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 603,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 533,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 448,\n    columnNumber: 5\n  }, this);\n};\n_s(VideoCallComponent, \"n1vx11Pg9On4rNudBxeNwVnkXx0=\");\n_c = VideoCallComponent;\nexport default VideoCallComponent;\nvar _c;\n$RefreshReg$(_c, \"VideoCallComponent\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","SockJS","Client","apiConfig","authHelpers","jsxDEV","_jsxDEV","VideoCallComponent","channelId","userId","userName","autoStart","prefetchMedia","_s","isCallActive","setIsCallActive","isVideoEnabled","setIsVideoEnabled","isAudioEnabled","setIsAudioEnabled","participants","setParticipants","stompClient","setStompClient","permissionStatus","setPermissionStatus","permissionError","setPermissionError","debugMsg","setDebugMsg","addDebug","msg","console","log","iceServers","useMemo","servers","urls","turnUrl","process","env","REACT_APP_TURN_URL","turnUser","REACT_APP_TURN_USERNAME","turnCred","REACT_APP_TURN_CREDENTIAL","trim","entry","username","credential","push","localVideoRef","remoteVideoRef","peerConnectionRef","localStreamRef","stompClientRef","isConnectedRef","pendingSignalsRef","flushPendingSignals","current","length","shift","JSON","stringify","publish","destination","body","signal","requestPermissions","active","getTracks","forEach","track","stop","stream","navigator","mediaDevices","getUserMedia","video","width","ideal","height","audio","echoCancellation","noiseSuppression","srcObject","play","e","message","error","errorMsg","name","initializeWebSocket","socket","websocketUrl","client","webSocketFactory","debug","str","reconnectDelay","onConnect","subscribe","handleSignalingMessage","handleCallEvent","onStompError","onWebSocketClose","activate","ok","prev","id","startCall","deactivate","payload","parse","type","fromUserId","String","handleOffer","offer","_peerConnectionRef$cu","state","signalingState","handleAnswer","answer","handleIceCandidate","candidate","event","filter","p","alert","Promise","resolve","setTimeout","hasPermissions","RTCPeerConnection","addTrack","ontrack","streams","_remoteVideoRef$curre","_remoteVideoRef$curre2","call","onicecandidate","sendSignalingMessage","createOffer","setLocalDescription","endCall","kind","close","toggleVideo","videoTrack","getVideoTracks","enabled","toggleAudio","audioTrack","getAudioTracks","setRemoteDescription","createAnswer","addIceCandidate","className","children","fileName","_jsxFileName","lineNumber","columnNumber","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","onClick","ref","autoPlay","muted","map","participant","_c","$RefreshReg$"],"sources":["C:/Users/HP/Desktop/Interacthub/frontend/src/components/common/VideoCallComponent.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport SockJS from 'sockjs-client';\r\nimport { Client } from '@stomp/stompjs';\r\nimport apiConfig from '../../config/api';\r\nimport { authHelpers } from '../../config/auth';\r\n\r\nconst VideoCallComponent = ({ channelId, userId, userName, autoStart = false, prefetchMedia = false }) => {\r\n  const [isCallActive, setIsCallActive] = useState(false);\r\n  const [isVideoEnabled, setIsVideoEnabled] = useState(true);\r\n  const [isAudioEnabled, setIsAudioEnabled] = useState(true);\r\n  const [participants, setParticipants] = useState([]);\r\n  const [stompClient, setStompClient] = useState(null);\r\n  const [permissionStatus, setPermissionStatus] = useState('idle'); // idle, pending, granted, denied\r\n  const [permissionError, setPermissionError] = useState('');\r\n  const [debugMsg, setDebugMsg] = useState('');\r\n  const addDebug = (msg) => { console.log(msg); setDebugMsg(msg); };\r\n  \r\n  // ICE servers (STUN + optional TURN from env)\r\n  const iceServers = React.useMemo(() => {\r\n    const servers = [\r\n      { urls: 'stun:stun.l.google.com:19302' },\r\n      { urls: 'stun:stun1.l.google.com:19302' }\r\n    ];\r\n    const turnUrl = process.env.REACT_APP_TURN_URL;\r\n    const turnUser = process.env.REACT_APP_TURN_USERNAME;\r\n    const turnCred = process.env.REACT_APP_TURN_CREDENTIAL;\r\n    if (turnUrl && turnUrl.trim()) {\r\n      const entry = { urls: turnUrl.trim() };\r\n      if (turnUser) entry.username = turnUser;\r\n      if (turnCred) entry.credential = turnCred;\r\n      servers.push(entry);\r\n      addDebug('[ice] TURN added: ' + turnUrl);\r\n    }\r\n    return servers;\r\n  }, []);\r\n  \r\n  const localVideoRef = useRef(null);\r\n  const remoteVideoRef = useRef(null);\r\n  const peerConnectionRef = useRef(null);\r\n  const localStreamRef = useRef(null);\r\n  const stompClientRef = useRef(null);\r\n  const isConnectedRef = useRef(false);\r\n  const pendingSignalsRef = useRef([]);\r\n\r\n  const flushPendingSignals = () => {\r\n    if (!isConnectedRef.current || !stompClientRef.current) return;\r\n    while (pendingSignalsRef.current.length) {\r\n      const msg = pendingSignalsRef.current.shift();\r\n      try {\r\n        addDebug('[signal:flush] '+JSON.stringify(msg));\r\n        stompClientRef.current.publish({\r\n          destination: `/app/chat.sendSignal`,\r\n          body: JSON.stringify({ channelId, signal: msg })\r\n        });\r\n      } catch {}\r\n    }\r\n  };\r\n\r\n  const requestPermissions = async () => {\r\n    try {\r\n      // If we already have a stream, reuse it\r\n      if (localStreamRef.current && localStreamRef.current.active) {\r\n        addDebug('[media] Reusing existing stream');\r\n        setPermissionStatus('granted');\r\n        return true;\r\n      }\r\n\r\n      // Stop any existing tracks first\r\n      if (localStreamRef.current) {\r\n        localStreamRef.current.getTracks().forEach(track => track.stop());\r\n        localStreamRef.current = null;\r\n      }\r\n\r\n      setPermissionStatus('pending');\r\n      setPermissionError('');\r\n      \r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: { width: { ideal: 1280 }, height: { ideal: 720 } },\r\n        audio: { echoCancellation: true, noiseSuppression: true }\r\n      });\r\n      \r\n      localStreamRef.current = stream;\r\n      if (localVideoRef.current) {\r\n        localVideoRef.current.srcObject = stream;\r\n        try { \r\n          await localVideoRef.current.play(); \r\n        } catch (e) {\r\n          addDebug('[video] Play error: ' + e.message);\r\n        }\r\n      }\r\n      \r\n      setPermissionStatus('granted');\r\n      addDebug('[media] Permissions granted');\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Permission denied:', error);\r\n      setPermissionStatus('denied');\r\n      \r\n      let errorMsg = error.message;\r\n      if (error.name === 'NotReadableError') {\r\n        errorMsg = 'Device in use by another application. Please close other apps using your camera/microphone.';\r\n      } else if (error.name === 'NotAllowedError') {\r\n        errorMsg = 'Permission denied. Please allow camera and microphone access.';\r\n      } else if (error.name === 'NotFoundError') {\r\n        errorMsg = 'No camera or microphone found. Please connect a device.';\r\n      }\r\n      \r\n      setPermissionError(errorMsg);\r\n      addDebug('[media] Error: ' + errorMsg);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const initializeWebSocket = useCallback(() => {\r\n    addDebug('[ws] initializing for channel '+channelId);\r\n    const socket = new SockJS(apiConfig.websocketUrl);\r\n    const client = new Client({ webSocketFactory: () => socket, debug: (str) => addDebug('[stomp] '+str), reconnectDelay: 5000 });\r\n    \r\n    client.onConnect = () => {\r\n      addDebug('[stomp] Connected');\r\n      stompClientRef.current = client;\r\n      setStompClient(client);\r\n      isConnectedRef.current = true;\r\n      \r\n      // Subscribe to signaling\r\n      client.subscribe(`/topic/channel.${channelId}.signal`, (msg) => { addDebug('[ws<-] '+msg.body); handleSignalingMessage(msg); });\r\n      client.subscribe(`/topic/channel.${channelId}.call`, handleCallEvent);\r\n      flushPendingSignals();\r\n    };\r\n    \r\n    client.onStompError = () => { addDebug('[stomp] error'); isConnectedRef.current = false; };\r\n    client.onWebSocketClose = () => { addDebug('[ws] closed'); isConnectedRef.current = false; };\r\n    \r\n    client.activate();\r\n  }, [channelId]);\r\n\r\n  useEffect(() => {\r\n    initializeWebSocket();\r\n    if (prefetchMedia && !localStreamRef.current) {\r\n      (async () => {\r\n        const ok = await requestPermissions();\r\n        if (ok) {\r\n          // Show local preview even before negotiation\r\n          setIsCallActive(true);\r\n          setParticipants(prev => (prev.length ? prev : [{ id: userId, name: userName }]));\r\n        }\r\n      })();\r\n    }\r\n    if (autoStart) {\r\n      // try to request permissions early; then start call\r\n      (async () => {\r\n        // If we already have a stream, don't re-prompt\r\n        let ok = true;\r\n        if (!localStreamRef.current) {\r\n          ok = await requestPermissions();\r\n        } else {\r\n          setPermissionStatus('granted');\r\n        }\r\n        if (ok && !isCallActive && channelId) {\r\n          await startCall();\r\n        }\r\n      })();\r\n    }\r\n    \r\n    return () => {\r\n      if (stompClientRef.current) {\r\n        stompClientRef.current.deactivate();\r\n      }\r\n      if (localStreamRef.current) {\r\n        localStreamRef.current.getTracks().forEach(track => track.stop());\r\n      }\r\n    };\r\n  }, [channelId, initializeWebSocket, autoStart]);\r\n\r\n  const handleSignalingMessage = (message) => {\r\n    const payload = typeof message?.body === 'string' ? JSON.parse(message.body) : message;\r\n    const signal = payload?.type ? payload : payload?.signal || {};\r\n    const fromUserId = payload?.userId || signal?.userId;\r\n    // Ignore echoes of our own messages\r\n    if (fromUserId && String(fromUserId) === String(userId)) {\r\n      addDebug('[ws<-] ignored self message ' + signal.type);\r\n      return;\r\n    }\r\n\r\n    if (signal.type === 'offer') {\r\n      handleOffer(signal.offer);\r\n    } else if (signal.type === 'answer') {\r\n      // Apply answer only if we are in the right state\r\n      const state = peerConnectionRef.current?.signalingState;\r\n      if (state !== 'have-local-offer') {\r\n        addDebug('[rtc] skip answer; state=' + state);\r\n        return;\r\n      }\r\n      handleAnswer(signal.answer);\r\n    } else if (signal.type === 'ice-candidate') {\r\n      handleIceCandidate(signal.candidate);\r\n    }\r\n  };\r\n\r\n  const handleCallEvent = (message) => {\r\n    const event = JSON.parse(message.body);\r\n    \r\n    if (event.type === 'user-joined') {\r\n      setParticipants(prev => [...prev, { id: event.userId, name: event.userName }]);\r\n    } else if (event.type === 'user-left') {\r\n      setParticipants(prev => prev.filter(p => p.id !== event.userId));\r\n    }\r\n  };\r\n\r\n  const startCall = async () => {\r\n    if (!channelId) {\r\n      alert('Please select a recipient first');\r\n      return;\r\n    }\r\n\r\n    // Ensure signaling connected before producing offer/ICE\r\n    if (!isConnectedRef.current) {\r\n      // wait briefly for connection\r\n      await new Promise(resolve => setTimeout(resolve, 300));\r\n    }\r\n \r\n    const hasPermissions = localStreamRef.current ? true : await requestPermissions();\r\n    if (!hasPermissions) {\r\n      alert('Camera and microphone permissions are required for video calls');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsCallActive(true);\r\n      \r\n      // Create peer connection\r\n      peerConnectionRef.current = new RTCPeerConnection({\r\n        iceServers\r\n      });\r\n\r\n      // Add tracks to peer connection\r\n      if (localStreamRef.current) {\r\n        localStreamRef.current.getTracks().forEach(track => {\r\n          peerConnectionRef.current.addTrack(track, localStreamRef.current);\r\n        });\r\n      }\r\n\r\n      // Handle remote stream\r\n      peerConnectionRef.current.ontrack = (event) => {\r\n        if (remoteVideoRef.current) {\r\n          remoteVideoRef.current.srcObject = event.streams[0];\r\n          try { remoteVideoRef.current.play?.(); } catch {}\r\n        }\r\n      };\r\n\r\n      // Handle ICE candidates\r\n      peerConnectionRef.current.onicecandidate = (event) => {\r\n        if (event.candidate) {\r\n          sendSignalingMessage({\r\n            type: 'ice-candidate',\r\n            candidate: event.candidate,\r\n            userId: userId\r\n          });\r\n        }\r\n      };\r\n\r\n      // Create and send offer\r\n      const offer = await peerConnectionRef.current.createOffer();\r\n      await peerConnectionRef.current.setLocalDescription(offer);\r\n      \r\n      sendSignalingMessage({\r\n        type: 'offer',\r\n        offer: offer,\r\n        userId: userId\r\n      });\r\n\r\n      // Notify others about call start\r\n      if (stompClientRef.current && isConnectedRef.current) {\r\n        stompClientRef.current.publish({\r\n          destination: `/app/chat.sendCallEvent`,\r\n          body: JSON.stringify({\r\n            channelId: channelId,\r\n            type: 'call-started',\r\n            userId: userId,\r\n            userName: userName\r\n          })\r\n        });\r\n      }\r\n\r\n      setIsCallActive(true);\r\n      setParticipants([{ id: userId, name: userName }]);\r\n\r\n    } catch (error) {\r\n      console.error('Error starting call:', error);\r\n      alert('Could not access camera/microphone. Please check permissions.');\r\n    }\r\n  };\r\n\r\n  const endCall = () => {\r\n    addDebug('[call] Ending call');\r\n    \r\n    // Stop all media tracks\r\n    if (localStreamRef.current) {\r\n      localStreamRef.current.getTracks().forEach(track => {\r\n        track.stop();\r\n        addDebug('[media] Stopped track: ' + track.kind);\r\n      });\r\n      localStreamRef.current = null;\r\n    }\r\n    \r\n    // Close peer connection\r\n    if (peerConnectionRef.current) {\r\n      peerConnectionRef.current.close();\r\n      peerConnectionRef.current = null;\r\n    }\r\n\r\n    // Clear video elements\r\n    if (localVideoRef.current) {\r\n      localVideoRef.current.srcObject = null;\r\n    }\r\n    if (remoteVideoRef.current) {\r\n      remoteVideoRef.current.srcObject = null;\r\n    }\r\n\r\n    // Notify others about call end\r\n    if (stompClientRef.current && isConnectedRef.current) {\r\n      try {\r\n        stompClientRef.current.publish({\r\n          destination: `/app/chat.sendCallEvent`,\r\n          body: JSON.stringify({\r\n            channelId: channelId,\r\n            type: 'call-ended',\r\n            userId: userId\r\n          })\r\n        });\r\n      } catch (e) {\r\n        addDebug('[ws] Error sending call-ended: ' + e.message);\r\n      }\r\n    }\r\n\r\n    setIsCallActive(false);\r\n    setParticipants([]);\r\n    setPermissionStatus('idle');\r\n    setIsVideoEnabled(true);\r\n    setIsAudioEnabled(true);\r\n  };\r\n\r\n  const toggleVideo = () => {\r\n    if (localStreamRef.current) {\r\n      const videoTrack = localStreamRef.current.getVideoTracks()[0];\r\n      if (videoTrack) {\r\n        videoTrack.enabled = !isVideoEnabled;\r\n        setIsVideoEnabled(!isVideoEnabled);\r\n      }\r\n    }\r\n  };\r\n\r\n  const toggleAudio = () => {\r\n    if (localStreamRef.current) {\r\n      const audioTrack = localStreamRef.current.getAudioTracks()[0];\r\n      if (audioTrack) {\r\n        audioTrack.enabled = !isAudioEnabled;\r\n        setIsAudioEnabled(!isAudioEnabled);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleOffer = async (offer) => {\r\n    try {\r\n      addDebug('[rtc<-] got offer');\r\n      if (!peerConnectionRef.current) {\r\n        addDebug('[rtc] No connection: callee building PC and starting local stream...');\r\n        peerConnectionRef.current = new RTCPeerConnection({\r\n          iceServers\r\n        });\r\n        peerConnectionRef.current.ontrack = (event) => {\r\n          if (remoteVideoRef.current) {\r\n            remoteVideoRef.current.srcObject = event.streams[0];\r\n          }\r\n        };\r\n        peerConnectionRef.current.onicecandidate = (event) => {\r\n          if (event.candidate) {\r\n            addDebug('[rtc ICE->]', event.candidate);\r\n            sendSignalingMessage({ type: 'ice-candidate', candidate: event.candidate, userId: userId });\r\n          }\r\n        };\r\n        if (!localStreamRef.current) {\r\n          const ok = await requestPermissions();\r\n          if (!ok) { addDebug('[media] denied'); return; }\r\n        }\r\n        if (localStreamRef.current) {\r\n          localStreamRef.current.getTracks().forEach(track => {\r\n            peerConnectionRef.current.addTrack(track, localStreamRef.current);\r\n          });\r\n        }\r\n        setIsCallActive(true);\r\n        setParticipants(prev => (prev.length ? prev : [{ id: userId, name: userName }]));\r\n      }\r\n      await peerConnectionRef.current.setRemoteDescription(offer);\r\n      addDebug('[rtc] Creating answer...');\r\n      const answer = await peerConnectionRef.current.createAnswer();\r\n      await peerConnectionRef.current.setLocalDescription(answer);\r\n      sendSignalingMessage({ type: 'answer', answer: answer, userId: userId });\r\n      addDebug('[rtc->] Sent answer');\r\n    } catch (error) {\r\n      addDebug('[rtc] offer ERROR: '+error.message);\r\n      console.error('Error handling offer:', error);\r\n      setDebugMsg('Offer negotiation failed: '+error.message);\r\n    }\r\n  };\r\n\r\n  const handleAnswer = async (answer) => {\r\n    try {\r\n      addDebug('[rtc<-] got answer');\r\n      await peerConnectionRef.current.setRemoteDescription(answer);\r\n      addDebug('[rtc] Set remotedesc (answer)');\r\n    } catch (error) {\r\n      addDebug('[rtc] answer ERROR: '+error.message);\r\n      console.error('Error handling answer:', error);\r\n    }\r\n  };\r\n\r\n  const handleIceCandidate = async (candidate) => {\r\n    try {\r\n      addDebug('[rtc<-] got ICE candidate');\r\n      await peerConnectionRef.current.addIceCandidate(candidate);\r\n      addDebug('[rtc] ICE add OK');\r\n    } catch (error) {\r\n      addDebug('[rtc] ICE ERROR: '+error.message);\r\n      console.error('Error handling ICE candidate:', error);\r\n    }\r\n  };\r\n\r\n  const sendSignalingMessage = (message) => {\r\n    if (stompClientRef.current && isConnectedRef.current) {\r\n      try {\r\n        addDebug('[ws->] '+JSON.stringify(message));\r\n        stompClientRef.current.publish({\r\n          destination: `/app/chat.sendSignal`,\r\n          body: JSON.stringify({ channelId, signal: message })\r\n        });\r\n      } catch (e) {\r\n        pendingSignalsRef.current.push(message);\r\n        addDebug('[ws~queue on error] '+JSON.stringify(message));\r\n      }\r\n    } else {\r\n      pendingSignalsRef.current.push(message);\r\n      addDebug('[ws~queue, not connected] '+JSON.stringify(message));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-lg shadow-md p-6\">\r\n      {debugMsg && (\r\n        <div className=\"mb-2 p-2 bg-yellow-100 text-yellow-900 rounded text-xs\">\r\n          {debugMsg}\r\n        </div>\r\n      )}\r\n      <h3 className=\"text-xl font-semibold mb-4 flex items-center\">\r\n        <svg className=\"w-6 h-6 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\" />\r\n        </svg>\r\n        Video Call - {channelId}\r\n      </h3>\r\n\r\n      {/* Permission Status */}\r\n      {permissionStatus === 'denied' && (\r\n        <div className=\"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg\">\r\n          <div className=\"flex items-start\">\r\n            <svg className=\"w-6 h-6 text-red-500 mr-3 flex-shrink-0 mt-0.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\" />\r\n            </svg>\r\n            <div className=\"flex-1\">\r\n              <h4 className=\"text-red-800 font-medium\">Camera/Microphone Access Denied</h4>\r\n              <p className=\"text-red-600 text-sm mt-1\">\r\n                {permissionError || 'Please allow camera and microphone access in your browser settings to use video calls.'}\r\n              </p>\r\n              <div className=\"mt-3 space-y-2\">\r\n                <button \r\n                  onClick={requestPermissions}\r\n                  className=\"px-4 py-2 bg-red-600 text-white text-sm rounded hover:bg-red-700 mr-2\"\r\n                >\r\n                  Try Again\r\n                </button>\r\n                <button \r\n                  onClick={() => {\r\n                    setPermissionStatus('idle');\r\n                    setPermissionError('');\r\n                  }}\r\n                  className=\"px-4 py-2 bg-gray-200 text-gray-700 text-sm rounded hover:bg-gray-300\"\r\n                >\r\n                  Cancel\r\n                </button>\r\n              </div>\r\n              <div className=\"mt-3 text-xs text-red-700 bg-red-100 p-2 rounded\">\r\n                <strong>Troubleshooting:</strong>\r\n                <ul className=\"list-disc list-inside mt-1 space-y-1\">\r\n                  <li>Close other apps using your camera/microphone (Zoom, Teams, etc.)</li>\r\n                  <li>Check browser permissions in Settings</li>\r\n                  <li>Reload the page and try again</li>\r\n                  <li>Make sure your device is properly connected</li>\r\n                </ul>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {permissionStatus === 'pending' && (\r\n        <div className=\"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg\">\r\n          <div className=\"flex items-center\">\r\n            <svg className=\"w-5 h-5 text-yellow-500 mr-2 animate-spin\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\r\n            </svg>\r\n            <span className=\"text-yellow-800\">Requesting camera and microphone permissions...</span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {!isCallActive ? (\r\n        <div className=\"text-center py-8\">\r\n          <div className=\"mb-4\">\r\n            <svg className=\"w-16 h-16 mx-auto text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\" />\r\n            </svg>\r\n          </div>\r\n          <button\r\n            onClick={startCall}\r\n            className=\"bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 flex items-center mx-auto\"\r\n          >\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z\" />\r\n            </svg>\r\n            Start Video Call\r\n          </button>\r\n        </div>\r\n      ) : (\r\n        <div className=\"space-y-4\">\r\n          {/* Video Streams */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            <div className=\"relative\">\r\n              <video\r\n                ref={localVideoRef}\r\n                autoPlay\r\n                muted\r\n                className=\"w-full h-48 bg-gray-900 rounded-lg\"\r\n              />\r\n              <div className=\"absolute bottom-2 left-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-sm\">\r\n                You\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"relative\">\r\n              <video\r\n                ref={remoteVideoRef}\r\n                autoPlay\r\n                className=\"w-full h-48 bg-gray-900 rounded-lg\"\r\n              />\r\n              <div className=\"absolute bottom-2 left-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-sm\">\r\n                Remote\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Call Controls */}\r\n          <div className=\"flex justify-center space-x-4\">\r\n            <button\r\n              onClick={toggleAudio}\r\n              className={`p-3 rounded-full ${\r\n                isAudioEnabled ? 'bg-green-600 text-white' : 'bg-red-600 text-white'\r\n              }`}\r\n            >\r\n              <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                {isAudioEnabled ? (\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\" />\r\n                ) : (\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z\" />\r\n                )}\r\n              </svg>\r\n            </button>\r\n\r\n            <button\r\n              onClick={toggleVideo}\r\n              className={`p-3 rounded-full ${\r\n                isVideoEnabled ? 'bg-green-600 text-white' : 'bg-red-600 text-white'\r\n              }`}\r\n            >\r\n              <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                {isVideoEnabled ? (\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\" />\r\n                ) : (\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21\" />\r\n                )}\r\n              </svg>\r\n            </button>\r\n\r\n            <button\r\n              onClick={endCall}\r\n              className=\"p-3 bg-red-600 text-white rounded-full hover:bg-red-700\"\r\n            >\r\n              <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n\r\n          {/* Participants */}\r\n          <div className=\"bg-gray-50 p-3 rounded-lg\">\r\n            <h4 className=\"text-sm font-medium text-gray-700 mb-2\">\r\n              Participants ({participants.length})\r\n            </h4>\r\n            <div className=\"flex flex-wrap gap-2\">\r\n              {participants.map((participant) => (\r\n                <span\r\n                  key={participant.id}\r\n                  className=\"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full\"\r\n                >\r\n                  {participant.name}\r\n                </span>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VideoCallComponent;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}